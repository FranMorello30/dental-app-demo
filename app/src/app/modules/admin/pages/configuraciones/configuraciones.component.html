<div class="min-h-screen w-full bg-slate-50">
	<div class="px-8 pb-12 pt-6 space-y-6">
		<div class="flex flex-wrap items-center justify-between gap-4">
			<div>
				<h1 class="text-2xl font-bold text-slate-900">Configuraciones del sistema</h1>
				<p class="text-sm text-slate-500">Administra la operación y preferencias de la clínica.</p>
			</div>
			<div class="flex flex-wrap gap-2">
				<button
					type="button"
					(click)="resetDefaults()"
					class="rounded-xl border border-slate-200 bg-white px-4 py-2 text-sm font-medium text-slate-700 shadow-sm transition hover:bg-slate-50"
				>
					Restaurar
				</button>
				<button
					type="button"
					(click)="saveSettings()"
					class="rounded-xl bg-blue-600 px-4 py-2 text-sm font-medium text-white shadow-sm transition hover:bg-blue-700"
					[disabled]="saving"
				>
					@if (saving) { Guardando... } @else { Guardar cambios }
				</button>
			</div>
		</div>

		@if (lastSavedAt) {
			<div class="rounded-2xl border border-emerald-200 bg-emerald-50 px-4 py-3 text-sm text-emerald-700">
				Última actualización: {{ lastSavedAt | date: 'medium' }}
			</div>
		}

		<form [formGroup]="form" class="grid gap-6 lg:grid-cols-3">
			<div class="lg:col-span-2 space-y-6">
				<div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
					<h2 class="text-lg font-semibold text-slate-900">Datos de la clínica</h2>
					<div class="mt-4 grid gap-4 sm:grid-cols-2">
						<div class="sm:col-span-2">
							<label class="text-sm font-semibold text-slate-700">Nombre</label>
							<input formControlName="clinicName" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900 focus:border-blue-500 focus:bg-white focus:ring-2 focus:ring-blue-100" />
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Correo</label>
							<input formControlName="clinicEmail" type="email" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900 focus:border-blue-500 focus:bg-white focus:ring-2 focus:ring-blue-100" />
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Teléfono</label>
							<input formControlName="clinicPhone" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900 focus:border-blue-500 focus:bg-white focus:ring-2 focus:ring-blue-100" />
						</div>
						<div class="sm:col-span-2">
							<label class="text-sm font-semibold text-slate-700">Dirección</label>
							<input formControlName="clinicAddress" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900 focus:border-blue-500 focus:bg-white focus:ring-2 focus:ring-blue-100" />
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Zona horaria</label>
							<select formControlName="timezone" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900">
								@for (tz of timezoneOptions; track tz) {
									<option [value]="tz">{{ tz }}</option>
								}
							</select>
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Moneda</label>
							<select formControlName="currency" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900">
								@for (item of currencyOptions; track item.value) {
									<option [value]="item.value">{{ item.label }}</option>
								}
							</select>
						</div>
					</div>
				</div>

				<div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
					<h2 class="text-lg font-semibold text-slate-900">Agenda y horarios</h2>
					<div class="mt-4 grid gap-4 sm:grid-cols-3">
						<div>
							<label class="text-sm font-semibold text-slate-700">Duración por cita (min)</label>
							<input type="number" formControlName="appointmentSlotMinutes" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900" />
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Inicio laboral</label>
							<input type="time" formControlName="defaultStartTime" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900" />
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Fin laboral</label>
							<input type="time" formControlName="defaultEndTime" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900" />
						</div>
					</div>
					<div class="mt-4 grid gap-3 sm:grid-cols-2">
						<label class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700">
							Permitir sobrecupo
							<input type="checkbox" formControlName="allowOverbooking" class="h-4 w-4" />
						</label>
						<label class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700">
							Requerir confirmación
							<input type="checkbox" formControlName="requireConfirmation" class="h-4 w-4" />
						</label>
					</div>
				</div>

				<div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
					<h2 class="text-lg font-semibold text-slate-900">Notificaciones</h2>
					<div class="mt-4 grid gap-3 sm:grid-cols-2">
						<label class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700">
							Enviar recordatorios por email
							<input type="checkbox" formControlName="sendEmailReminders" class="h-4 w-4" />
						</label>
						<label class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700">
							Enviar recordatorios por WhatsApp
							<input type="checkbox" formControlName="sendWhatsappReminders" class="h-4 w-4" />
						</label>
					</div>
					<div class="mt-4">
						<label class="text-sm font-semibold text-slate-700">Horas antes para recordatorio</label>
						<input type="number" formControlName="reminderHoursBefore" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2.5 text-sm text-slate-900" />
					</div>
				</div>
			</div>

			<div class="space-y-6">
				<div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
					<h2 class="text-lg font-semibold text-slate-900">Seguridad</h2>
					<div class="mt-4 space-y-3">
						<label class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700">
							Registro de auditoría
							<input type="checkbox" formControlName="enableAuditLog" class="h-4 w-4" />
						</label>
						<label class="flex items-center justify-between rounded-xl border border-slate-100 bg-slate-50 px-4 py-3 text-sm text-slate-700">
							Autenticación 2FA
							<input type="checkbox" formControlName="enableTwoFactor" class="h-4 w-4" />
						</label>
					</div>
				</div>

				<div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
					<h2 class="text-lg font-semibold text-slate-900">Marca</h2>
					<div class="mt-4 space-y-4">
						<div>
							<label class="text-sm font-semibold text-slate-700">Color primario</label>
							<div class="mt-2 flex items-center gap-3">
								<input type="color" formControlName="brandPrimary" class="h-10 w-12 rounded border border-slate-200" />
								<input formControlName="brandPrimary" class="flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900" />
							</div>
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Color secundario</label>
							<div class="mt-2 flex items-center gap-3">
								<input type="color" formControlName="brandSecondary" class="h-10 w-12 rounded border border-slate-200" />
								<input formControlName="brandSecondary" class="flex-1 rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900" />
							</div>
						</div>
						<div class="rounded-xl border border-slate-100 bg-slate-50 p-4">
							<p class="text-xs font-semibold uppercase text-slate-400">Vista previa</p>
							<div class="mt-3 flex items-center gap-2">
								<span class="h-3 w-3 rounded-full" [style.background]="form.value.brandPrimary"></span>
								<span class="text-sm text-slate-600">Primario</span>
							</div>
							<div class="mt-2 flex items-center gap-2">
								<span class="h-3 w-3 rounded-full" [style.background]="form.value.brandSecondary"></span>
								<span class="text-sm text-slate-600">Secundario</span>
							</div>
						</div>
					</div>
				</div>

				<div class="rounded-2xl border border-slate-200 bg-white p-6 shadow-sm">
					<div class="flex items-center justify-between">
						<h2 class="text-lg font-semibold text-slate-900">Especialidades</h2>
						<button
							type="button"
							(click)="loadSpecialties()"
							class="rounded-lg border border-slate-200 bg-white px-3 py-1.5 text-xs font-semibold text-slate-600"
						>
							Actualizar
						</button>
					</div>

					@if (specialtiesError) {
						<div class="mt-3 rounded-xl border border-red-200 bg-red-50 px-3 py-2 text-xs text-red-600">
							{{ specialtiesError }}
						</div>
					}

					<form [formGroup]="specialtyForm" class="mt-4 space-y-3">
						<div>
							<label class="text-sm font-semibold text-slate-700">Nombre</label>
							<input formControlName="name" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900" placeholder="Ej: Ortodoncia" />
						</div>
						<div>
							<label class="text-sm font-semibold text-slate-700">Descripción</label>
							<textarea formControlName="description" rows="2" class="mt-2 w-full rounded-lg border border-slate-200 bg-slate-50 px-3 py-2 text-sm text-slate-900" placeholder="Detalle breve"></textarea>
						</div>
						<button
							type="button"
							(click)="addSpecialty()"
							class="w-full rounded-xl bg-blue-600 px-3 py-2 text-sm font-semibold text-white shadow-sm transition hover:bg-blue-700"
							[disabled]="specialtiesSaving"
						>
							@if (specialtiesSaving) { Guardando... } @else { Agregar especialidad }
						</button>
					</form>

					<div class="mt-5">
						<p class="text-xs font-semibold uppercase text-slate-400">Registradas</p>
						@if (specialtiesLoading) {
							<p class="mt-2 text-sm text-slate-500">Cargando especialidades...</p>
						} @else if (specialties.length) {
							<div class="mt-3 space-y-3">
								@for (item of specialties; track item.id) {
									<div class="rounded-xl border border-slate-100 bg-slate-50 px-3 py-2">
										<p class="text-sm font-semibold text-slate-900">{{ item.name }}</p>
										@if (item.description) {
											<p class="text-xs text-slate-500">{{ item.description }}</p>
										}
									</div>
								}
							</div>
						} @else {
							<p class="mt-2 text-sm text-slate-500">No hay especialidades registradas.</p>
						}
					</div>
				</div>
			</div>
		</form>
	</div>
</div>
